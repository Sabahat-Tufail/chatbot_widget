class w {
  constructor({ apiKey: e, sessionId: t, url: i }) {
    this.apiKey = e, this.sessionId = t, this.url = i, this.conversation = JSON.parse(localStorage.getItem("chatWidgetHistory") || "[]"), this.initWidget();
  }
  initWidget() {
    const e = document.createElement("style");
    e.textContent = `
        .chat-widget-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
            z-index: 9999;
        }
        .chat-widget-header {
            padding: 10px;
            background: #007bff;
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0;
            text-align: center;
        }
        .chat-widget-box {
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
        }
        .chat-widget-message {
            padding: 8px;
            margin-bottom: 6px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .chat-widget-user { background: #d1e7ff; margin-left: auto; }
        .chat-widget-assistant { background: #e9ecef; margin-right: auto; }
        .chat-widget-form { display: flex; }
        .chat-widget-form input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px 0 0 6px; }
        .chat-widget-form button { padding: 8px 15px; border: none; background: #007bff; color: white; border-radius: 0 6px 6px 0; cursor: pointer; }
        .chat-widget-clear { width: 100%; padding: 8px; border: none; background: #dc3545; color: white; cursor: pointer; border-radius: 0 0 10px 10px; }
        `, document.head.appendChild(e), this.container = document.createElement("div"), this.container.className = "chat-widget-container", this.container.innerHTML = `
            <div class="chat-widget-header">Chatbot</div>
            <div class="chat-widget-box" id="chat-widget-box"></div>
            <form class="chat-widget-form" id="chat-widget-form">
                <input id="chat-widget-input" placeholder="Type your message..." />
                <button type="submit">Send</button>
            </form>
            <button class="chat-widget-clear" id="chat-widget-clear">New Chat</button>
        `, document.body.appendChild(this.container), this.chatBox = this.container.querySelector("#chat-widget-box"), this.chatInput = this.container.querySelector("#chat-widget-input"), this.chatForm = this.container.querySelector("#chat-widget-form"), this.clearBtn = this.container.querySelector("#chat-widget-clear"), this.chatForm.addEventListener("submit", (t) => this.sendMessage(t)), this.clearBtn.addEventListener("click", () => this.clearChat()), this.renderChat();
  }
  renderChat() {
    this.chatBox.innerHTML = "", this.conversation.forEach((e) => {
      const t = document.createElement("div");
      t.className = `chat-widget-message ${e.role === "user" ? "chat-widget-user" : "chat-widget-assistant"}`, t.textContent = e.content, this.chatBox.appendChild(t);
    }), this.chatBox.scrollTop = this.chatBox.scrollHeight;
  }
  saveChat() {
    localStorage.setItem("chatWidgetHistory", JSON.stringify(this.conversation));
  }
  async sendMessage(e) {
    e.preventDefault();
    const t = this.chatInput.value.trim();
    if (!t) return;
    this.conversation.push({ role: "user", content: t }), this.chatInput.value = "", this.renderChat();
    const i = document.createElement("div");
    i.className = "chat-widget-message chat-widget-assistant", i.textContent = "", this.chatBox.appendChild(i);
    try {
      const a = await fetch(this.url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-session-id": this.sessionId,
          "x-api-key": this.apiKey
        },
        body: JSON.stringify({ conversation: this.conversation })
      });
      if (!a.ok) {
        i.textContent = `[Error: ${a.status}]`;
        return;
      }
      const c = a.body.getReader(), d = new TextDecoder();
      let o = "";
      for (; ; ) {
        const { value: h, done: l } = await c.read();
        if (l) break;
        const p = d.decode(h, { stream: !0 }).split(`
`).filter((r) => r.startsWith("data: "));
        for (const r of p) {
          const s = r.replace("data: ", "").trim();
          if (s !== "[DONE]")
            try {
              const n = JSON.parse(s).content || "";
              n && (o += n, i.textContent = o, this.chatBox.scrollTop = this.chatBox.scrollHeight);
            } catch {
            }
        }
      }
      this.conversation.push({ role: "assistant", content: o }), this.renderChat(), this.saveChat();
    } catch (a) {
      console.error(a), i.textContent = "[Network error]";
    }
  }
  clearChat() {
    confirm("Are you sure you want to clear chat?") && (this.conversation = [], localStorage.removeItem("chatWidgetHistory"), this.renderChat());
  }
}
export {
  w as ChatWidget
};
