(function () {
  const a = "https://sabahat-demo.aidemo.buzz/chat/stream", r = "123abcXYZ,./", d = "test-session-123";
  class c {
    constructor({ apiUrl: e, apiKey: t, sessionId: i } = {}) {
      const n = localStorage.getItem("sessionId");
      if (this.sessionId = n || i || d, n || localStorage.setItem("sessionId", this.sessionId), this.apiUrl = e || a, this.apiKey = t || r, this.conversation = JSON.parse(localStorage.getItem("chatHistory") || "[]"), document.getElementById("cw-root")) {
        console.warn("ChatWidget already initialized on this page.");
        return;
      }
      this._init();
    }
    _generateUUID() {
      return crypto && crypto.randomUUID ? crypto.randomUUID() : "cw-" + Math.random().toString(36).slice(2, 10);
    }
    _init() {
      this._injectCSS(), this._createElements(), this._bindElements(), this._addEventListeners(), this._renderChat();
    }
    // Inject styles for modal + button + chat UI
    _injectCSS() {
      const e = `
/* ChatWidget styles (injected) */
#cw-root { font-family: Arial, sans-serif; z-index: 2147483647; }
#cw-toggle {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 2147483647;
  padding: 12px 18px;
  border-radius: 28px;
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  font-size: 15px;
  display: flex;
  gap: 10px;
  align-items: center;
}
#cw-toggle img { width: 20px; height: 20px; }

/* Modal overlay */
#cw-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.35);
  z-index: 2147483646;
}

/* Centered chat panel */
#cw-panel {
  width: min(920px, calc(100% - 64px));
  max-width: 920px;
  height: min(720px, calc(100% - 96px));
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 12px 40px rgba(16,24,40,0.25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Header */
#cw-header {
  display:flex;
  align-items:center;
  gap:12px;
  padding:14px 18px;
  border-bottom: 1px solid #e6e6e6;
  background: #ffffff;
}
#cw-header h2 {
  margin:0;
  font-size:16px;
  color: #0f172a;
}
#cw-sub {
  margin-left: auto;
  color: #6b7280;
  font-size:13px;
}

/* Chat area */
#cw-chat {
  padding: 14px;
  background: #fafafa;
  flex: 1;
  overflow-y: auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}

/* Message bubbles */
.cw-message {
  padding: 10px 14px;
  border-radius: 12px;
  max-width: 80%;
  word-wrap: break-word;
  line-height: 1.35;
}
.cw-message.user {
  background: #d1e7ff;
  align-self: flex-end;
}
.cw-message.assistant {
  background: #e9ecef;
  align-self: flex-start;
}

/* Composer */
#cw-composer {
  display:flex;
  gap:8px;
  padding: 12px;
  border-top: 1px solid #e6e6e6;
  background: #fff;
}
#cw-input {
  flex:1;
  padding:10px 12px;
  border:1px solid #ddd;
  border-radius:8px;
  outline:none;
  font-size:14px;
}
#cw-send {
  padding:10px 14px;
  background:#007bff;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

/* Footer actions */
#cw-actions {
  padding:10px 12px;
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
  background:#fff;
  border-top:1px solid #f1f1f1;
}
#cw-clear {
  background:#dc3545;
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
}
#cw-help {
  color:#6b7280;
  font-size:13px;
}

/* Responsive */
@media (max-width: 700px) {
  #cw-panel { width: calc(100% - 40px); height: calc(100% - 80px); border-radius:10px; }
  #cw-toggle { right: 14px; bottom: 14px; padding:10px 14px; font-size:14px; }
}
`, t = document.createElement("style");
      t.id = "cw-styles", t.textContent = e, document.head.appendChild(t);
    }
    _createElements() {
      const e = document.createElement("div");
      e.id = "cw-root", document.body.appendChild(e), e.innerHTML = `
        <button id="cw-toggle" aria-label="Open chat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M21 15a2 2 0 0 1-2 2H8l-5 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="white"/>
          </svg>
          <span>Need assistance? Chat with your assistant</span>
        </button>

        <div id="cw-overlay" role="dialog" aria-modal="true">
          <div id="cw-panel" role="document">
            <div id="cw-header">
              <div>
                <h2>Your Assistant</h2>
                <div id="cw-sub">I can help with questions ‚Äî ask anything.</div>
              </div>
              <div style="margin-left:auto;">
                <button id="cw-close" title="Close" style="border:none;background:transparent;cursor:pointer;font-size:18px;">‚úï</button>
              </div>
            </div>

            <div id="cw-chat" aria-live="polite"></div>

            <div id="cw-composer">
              <input id="cw-input" type="text" placeholder="Type your message..." autocomplete="off" />
              <button id="cw-send">Send</button>
            </div>

            <div id="cw-actions">
              <div id="cw-help">Tip: try "How do I deploy this?"</div>
              <button id="cw-clear">üóëÔ∏è New Chat</button>
            </div>
          </div>
        </div>
      `, this.root = document.getElementById("cw-root"), this.toggleBtn = document.getElementById("cw-toggle"), this.overlay = document.getElementById("cw-overlay"), this.panel = document.getElementById("cw-panel"), this.closeBtn = document.getElementById("cw-close"), this.chat = document.getElementById("cw-chat"), this.input = document.getElementById("cw-input"), this.sendBtn = document.getElementById("cw-send"), this.clearBtn = document.getElementById("cw-clear");
    }
    _bindElements() {
    }
    _addEventListeners() {
      this.toggleBtn.addEventListener("click", () => {
        this.open();
      }), this.closeBtn.addEventListener("click", () => this.close()), this.overlay.addEventListener("click", (e) => {
        e.target === this.overlay && this.close();
      }), this.sendBtn.addEventListener("click", (e) => this._handleSend(e)), this.input.addEventListener("keydown", (e) => {
        e.key === "Enter" && !e.shiftKey && (e.preventDefault(), this._handleSend(e));
      }), this.clearBtn.addEventListener("click", async () => {
        if (confirm("Are you sure you want to delete this conversation?")) {
          localStorage.removeItem("chatHistory"), this.conversation = [], this._renderChat();
          try {
            await fetch(this.apiUrl + "?reset=true", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "x-session-id": this.sessionId
              },
              body: JSON.stringify({ conversation: [] })
            });
          } catch {
          }
        }
      }), window.addEventListener("keydown", (e) => {
        e.key === "Escape" && this.isOpen && this.close();
      });
    }
    open() {
      this.overlay.style.display = "flex", this.isOpen = !0, setTimeout(() => this.input.focus(), 120);
    }
    close() {
      this.overlay.style.display = "none", this.isOpen = !1, setTimeout(() => this.toggleBtn.focus(), 50);
    }
    _renderChat() {
      this.chat.innerHTML = "", this.conversation.forEach((e) => {
        const t = document.createElement("div");
        t.classList.add("cw-message", e.role), t.textContent = e.content, this.chat.appendChild(t);
      }), this.chat.scrollTop = this.chat.scrollHeight;
    }
    _saveChat() {
      localStorage.setItem("chatHistory", JSON.stringify(this.conversation));
    }
    async _handleSend(e) {
      e && e.preventDefault && e.preventDefault();
      const t = this.input.value.trim();
      if (!t) return;
      this.conversation.push({ role: "user", content: t }), this._saveChat(), this._renderChat(), this.input.value = "";
      const i = document.createElement("div");
      i.classList.add("cw-message", "assistant"), i.textContent = "", this.chat.appendChild(i), this.chat.scrollTop = this.chat.scrollHeight;
      try {
        const n = await fetch(this.apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-session-id": this.sessionId,
            "x-api-key": this.apiKey
          },
          body: JSON.stringify({ conversation: this.conversation })
        });
        if (!n.ok) {
          i.textContent = `[Error: ${n.status}]`;
          return;
        }
        const f = n.body.getReader(), u = new TextDecoder();
        let s = "";
        for (; ;) {
          const { value: g, done: x } = await f.read();
          if (x) break;
          const m = u.decode(g, { stream: !0 }).split(`
`).filter((o) => o.startsWith("data: "));
          for (const o of m) {
            const h = o.replace("data: ", "").trim();
            if (h !== "[DONE]")
              try {
                const p = JSON.parse(h).content || "";
                p && (s += p, i.textContent = s, this.chat.scrollTop = this.chat.scrollHeight);
              } catch {
              }
          }
        }
        this.conversation.push({ role: "assistant", content: s }), this._saveChat(), this._renderChat();
      } catch (n) {
        console.error("Network error:", n), i.textContent = "[Network error]";
      }
    }
  }
  window.ChatWidget = c;
  try {
    new c({
      apiUrl: a,
      apiKey: r,
      sessionId: d
    });
  } catch (l) {
    console.error("Failed to initialize ChatWidget", l);
  }
})();
