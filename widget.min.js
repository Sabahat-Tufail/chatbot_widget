(function () {
  const a = "https://sabahat-demo.aidemo.buzz/chat/stream", r = "123abcXYZ,./", d = "test-session-123";
  class c {
    constructor({ apiUrl: e, apiKey: t, sessionId: n } = {}) {
      const o = localStorage.getItem("sessionId");
      if (this.sessionId = o || n || d, o || localStorage.setItem("sessionId", this.sessionId), this.apiUrl = e || a, this.apiKey = t || r, this.conversation = JSON.parse(localStorage.getItem("chatHistory") || "[]"), document.getElementById("cw-root")) {
        console.warn("ChatWidget already initialized on this page.");
        return;
      }
      this._init();
    }
    _generateUUID() {
      return crypto && crypto.randomUUID ? crypto.randomUUID() : "cw-" + Math.random().toString(36).slice(2, 10);
    }
    _init() {
      this._injectCSS(), this._createElements(), this._bindElements(), this._addEventListeners(), this._renderChat();
    }
    // Inject styles for modal + button + chat UI
    _injectCSS() {
      const e = `
/* ====== Petalnex Style ChatWidget ====== */

#cw-root {
  font-family: "Inter", Arial, sans-serif;
  z-index: 2147483647;
}

/* Floating toggle button */
#cw-toggle {
  position: fixed;
  bottom: 24px;
  right: 24px;
  padding: 14px 22px;
  border-radius: 40px;
  background: #2867FF; /* keep lighter blue */
  color: #fff;
  border: none;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 8px 20px rgba(0,0,128,0.25); /* navy shadow */
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 15px;
  transition: 0.2s ease;
}
#cw-toggle:hover {
  background: #000080; /* navy blue hover */
  box-shadow: 0 10px 26px rgba(0,0,128,0.35); /* navy shadow */
}

/* Overlay */
#cw-overlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(11, 28, 57, 0.25);
}

/* Chat Panel */
#cw-panel {
  width: min(920px, calc(100% - 64px));
  max-width: 920px;
  height: min(720px, calc(100% - 96px));
  background: linear-gradient(135deg, #ECF2FF 0%, #FFFFFF 100%);
  border-radius: 16px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  animation: cwFadeIn 0.35s ease;
}

@keyframes cwFadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Header */
#cw-header {
  padding: 18px 24px;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #dbe4ff;
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(6px);
}
#cw-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
  color: #0B1C39;
}
#cw-sub {
  margin-top: 2px;
  font-size: 13px;
  color: #5D6A89;
}

/* Chat Area */
#cw-chat {
  padding: 18px;
  flex: 1;
  overflow-y: auto;
  background: #F5F8FF;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Message bubbles */
.cw-message {
  padding: 12px 16px;
  border-radius: 14px;
  max-width: 80%;
  line-height: 1.45;
  font-size: 14px;
}
.cw-message.user {
  align-self: flex-end;
  background: #000080; /* navy blue user bubble */
  color: #fff;
  box-shadow: 0 4px 12px rgba(0,0,128,0.25); /* navy shadow */
}
.cw-message.assistant {
  align-self: flex-start;
  background: #FFFFFF;
  color: #0B1C39;
  border: 1px solid #dbe4ff;
  box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}

/* Composer */
#cw-composer {
  padding: 14px;
  display: flex;
  gap: 10px;
  background: #fff;
  border-top: 1px solid #e9ecf5;
}
#cw-input {
  flex: 1;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid #cdd6f7;
  background: #F5F8FF;
  outline: none;
  transition: 0.2s;
}
#cw-input:focus {
  border-color: #000080; /* navy focus */
  box-shadow: 0 0 0 2px rgba(0,0,128,0.2);
}
#cw-send {
  padding: 10px 18px;
  background: #000080; /* navy send button */
  color: #fff;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 8px 20px rgba(0,0,128,0.25); /* navy shadow */
  transition: 0.2s ease;
}
#cw-send:hover {
  background: #000066; /* darker navy hover */
}

/* Footer actions */
#cw-actions {
  padding: 12px 16px;
  background: #fff;
  border-top: 1px solid #dbe4ff;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
#cw-help {
  font-size: 13px;
  color: #6b7b9a;
}
#cw-clear {
  background-color: #000080; /* navy */
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 6px 16px rgba(0,0,128,0.25);
  transition: 0.2s;
}
#cw-clear:hover {
  background: #000066; /* darker navy hover */
}
  `, t = document.createElement("style");
      t.id = "cw-styles", t.textContent = e, document.head.appendChild(t);
    }
    _createElements() {
      const e = document.createElement("div");
      e.id = "cw-root", document.body.appendChild(e), e.innerHTML = `
        <button id="cw-toggle" aria-label="Open chat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M21 15a2 2 0 0 1-2 2H8l-5 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" fill="white"/>
          </svg>
          <span>Need assistance? Chat with your assistant</span>
        </button>

        <div id="cw-overlay" role="dialog" aria-modal="true">
          <div id="cw-panel" role="document">
            <div id="cw-header">
              <div>
                <h2>Your Assistant</h2>
                <div id="cw-sub">I can help with questions ‚Äî ask anything.</div>
              </div>
              <div style="margin-left:auto;">
                <button id="cw-close" title="Close" style="border:none;background:transparent;cursor:pointer;font-size:18px;">‚úï</button>
              </div>
            </div>

            <div id="cw-chat" aria-live="polite"></div>

            <div id="cw-composer">
              <input id="cw-input" type="text" placeholder="Type your message..." autocomplete="off" />
              <button id="cw-send">Send</button>
            </div>

            <div id="cw-actions">
              <div id="cw-help">Tip: try "How do I deploy this?"</div>
              <button id="cw-clear">üóëÔ∏è New Chat</button>
            </div>
          </div>
        </div>
      `, this.root = document.getElementById("cw-root"), this.toggleBtn = document.getElementById("cw-toggle"), this.overlay = document.getElementById("cw-overlay"), this.panel = document.getElementById("cw-panel"), this.closeBtn = document.getElementById("cw-close"), this.chat = document.getElementById("cw-chat"), this.input = document.getElementById("cw-input"), this.sendBtn = document.getElementById("cw-send"), this.clearBtn = document.getElementById("cw-clear");
    }
    _bindElements() {
    }
    _addEventListeners() {
      this.toggleBtn.addEventListener("click", () => {
        this.open();
      }), this.closeBtn.addEventListener("click", () => this.close()), this.overlay.addEventListener("click", (e) => {
        e.target === this.overlay && this.close();
      }), this.sendBtn.addEventListener("click", (e) => this._handleSend(e)), this.input.addEventListener("keydown", (e) => {
        e.key === "Enter" && !e.shiftKey && (e.preventDefault(), this._handleSend(e));
      }), this.clearBtn.addEventListener("click", async () => {
        if (confirm("Are you sure you want to delete this conversation?")) {
          localStorage.removeItem("chatHistory"), this.conversation = [], this._renderChat();
          try {
            await fetch(this.apiUrl + "?reset=true", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "x-session-id": this.sessionId
              },
              body: JSON.stringify({ conversation: [] })
            });
          } catch {
          }
        }
      }), window.addEventListener("keydown", (e) => {
        e.key === "Escape" && this.isOpen && this.close();
      });
    }
    open() {
      this.overlay.style.display = "flex", this.isOpen = !0, setTimeout(() => this.input.focus(), 120);
    }
    close() {
      this.overlay.style.display = "none", this.isOpen = !1, setTimeout(() => this.toggleBtn.focus(), 50);
    }
    _renderChat() {
      this.chat.innerHTML = "", this.conversation.forEach((e) => {
        const t = document.createElement("div");
        t.classList.add("cw-message", e.role), t.textContent = e.content, this.chat.appendChild(t);
      }), this.chat.scrollTop = this.chat.scrollHeight;
    }
    _saveChat() {
      localStorage.setItem("chatHistory", JSON.stringify(this.conversation));
    }
    async _handleSend(e) {
      e && e.preventDefault && e.preventDefault();
      const t = this.input.value.trim();
      if (!t) return;
      this.conversation.push({ role: "user", content: t }), this._saveChat(), this._renderChat(), this.input.value = "";
      const n = document.createElement("div");
      n.classList.add("cw-message", "assistant"), n.textContent = "", this.chat.appendChild(n), this.chat.scrollTop = this.chat.scrollHeight;
      try {
        const o = await fetch(this.apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-session-id": this.sessionId,
            "x-api-key": this.apiKey
          },
          body: JSON.stringify({ conversation: this.conversation })
        });
        if (!o.ok) {
          n.textContent = `[Error: ${o.status}]`;
          return;
        }
        const u = o.body.getReader(), g = new TextDecoder();
        let i = "";
        for (; ;) {
          const { value: x, done: f } = await u.read();
          if (f) break;
          const w = g.decode(x, { stream: !0 }).split(`
`).filter((s) => s.startsWith("data: "));
          for (const s of w) {
            const h = s.replace("data: ", "").trim();
            if (h !== "[DONE]")
              try {
                const p = JSON.parse(h).content || "";
                p && (i += p, n.textContent = i, this.chat.scrollTop = this.chat.scrollHeight);
              } catch {
              }
          }
        }
        this.conversation.push({ role: "assistant", content: i }), this._saveChat(), this._renderChat();
      } catch (o) {
        console.error("Network error:", o), n.textContent = "[Network error]";
      }
    }
  }
  window.ChatWidget = c;
  try {
    new c({
      apiUrl: a,
      apiKey: r,
      sessionId: d
    });
  } catch (l) {
    console.error("Failed to initialize ChatWidget", l);
  }
})();
